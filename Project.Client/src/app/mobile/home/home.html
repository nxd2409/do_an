<div class="main-content">
  <!-- Header -->
  <div class="header">
    <div class="x-meet">xMeet</div>

    <div class="calendar-icon">
      <button nz-button nzType="default" nzSize="large" nzShape="circle" (click)="modalProfileOpen()">
        <nz-icon nzType="user" nzTheme="outline" />
      </button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="btn-action">
    <button nz-button nzType="primary" class="btn-meet" nz-dropdown [nzDropdownMenu]="inputCreateMeeting"
      nzTrigger="click">
      <nz-icon nzType="video-camera" nzTheme="fill" />
      <div class="btn-text">
        <span class="btn-title">Cuộc họp mới</span>
        <span class="btn-subtitle">Bắt đầu cuộc họp</span>
      </div>
    </button>

    <nz-dropdown-menu #inputCreateMeeting="nzDropdownMenu">
      <div class="dropdown-input">
        <div style="margin-bottom: 12px;" class="dropdown-join-meeting">
          <label>Cuộc họp mới</label>
          <nz-input-search nzEnterButton="Bắt đầu" (nzSearch)="onStartMeeting()">
            <input nz-input placeholder="Tên cuộc họp" [(ngModel)]="nameMeeting" />
          </nz-input-search>
        </div>
        <div>
          <label>Nhập mã cuộc họp</label>
          <nz-input-search nzEnterButton="Tham gia" (nzSearch)="onOpenMeetingByCode()">
            <input nz-input [(ngModel)]="linkMeeting" />
          </nz-input-search>
        </div>
      </div>
    </nz-dropdown-menu>

    <button nz-button nzType="default" class="btn-meet" (click)="openQRScanner()">
      <nz-icon nzType="scan" nzTheme="outline" />
      <div class="btn-text">
        <span class="btn-title">Quét QR</span>
        <span class="btn-subtitle">Quét QR cuộc họp</span>
      </div>
    </button>
  </div>

  <div class="search-input">
    <nz-input-search (nzSearch)="searchMeeting()">
      <input [(ngModel)]="filter.name" (keydown.enter)="searchMeeting()" nz-input placeholder="Tìm kiếm cuộc họp" />
      <nz-icon nzInputSuffix nzType="calendar" (click)="openDrawerCalendar()" />
    </nz-input-search>
  </div>

  <div class="search-meeting">
    <nz-segmented [(ngModel)]="filter.status" (ngModelChange)="searchMeeting()">
      <label nz-segmented-item [nzValue]="meetingStatus.ChuaBatDau">
        <div>Sắp diễn ra
          <nz-badge nzStandalone [nzCount]="listMeeting.countMeeting.sapDienRa || 0" style="margin: 0px 0px 3px 0px" />
        </div>
      </label>
      <label nz-segmented-item [nzValue]="meetingStatus.DangHop">
        <div>
          Đang diễn ra
          <nz-badge nzStandalone [nzCount]="listMeeting.countMeeting.dangDienRa || 0" style="margin: 0px 0px 3px 0px" />
        </div>
      </label>
      <label nz-segmented-item [nzValue]="meetingStatus.KetThuc">
        <div>Kết thúc</div>
      </label>
    </nz-segmented>
  </div>

  <div class="list-meeting">
  @for(data of listMeeting.data; track data){
  <div class="meeting-card" (click)="openMeetingDetail(data)">
    <div class="meeting-header">
      <div class="meeting-title">{{data.name}}</div>
      <span class="meeting-status status-upcoming" *ngIf="data.status == meetingStatus.ChuaBatDau">
        Sắp diễn ra
      </span>
      <span class="live-indicator" *ngIf="data.status == meetingStatus.DangHop">
        <span class="live-dot"></span> LIVE
      </span>
      <span class="meeting-status status-finished" *ngIf="data.status == meetingStatus.KetThuc">
        Đã kết thúc
      </span>
    </div>

    <div class="meeting-info">
      <div class="info-row">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <span>{{data.expectedStartTime | date: 'dd/MM/yyyy HH:mm'}}</span>
      </div>
      <div class="info-row">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        <span>{{data.address ? data.address : 'Trực tuyến qua hệ thống SMR'}}</span>
      </div>
    </div>

    <div class="meeting-footer">
      <div class="meeting-participants">
        <div class="avatar-group">
          <nz-avatar-group *ngIf="data?.personal?.length > 0">
            <ng-container *ngFor="let person of data.personal; let idx = index">
              <nz-avatar *ngIf="idx < 4" nz-tooltip [nzTooltipTitle]="person.fullName" nzTooltipPlacement="top"
                [nzText]="global.getInitialsAvatar(person.fullName)" [nzSize]="28"
                [ngStyle]="{'background-color': global.getAvatarColor(person.fullName), color: 'white','font-weight': 600}">
              </nz-avatar>
            </ng-container>
            <nz-avatar *ngIf="data.personal.length > 4" [nzText]="'+' + (data.personal.length - 4)" [nzSize]="28"
              [ngStyle]="{'background-color': '#d9d9d9',color: '#333','font-weight': 600}">
            </nz-avatar>
          </nz-avatar-group>
        </div>
        <span class="participant-count">{{data.personal.length}} thành viên</span>
      </div>

      <div class="meeting-action-hint">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="arrow-icon">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </div>
    </div>
  </div>
  }
</div>

</div>

<nz-modal nzWidth="100%" [(nzVisible)]="isVisibleCreateMeeting" [nzStyle]="{ top: '0px' }" [nzTitle]="undefined"
  (nzOnCancel)="createMeetingClose()" (nzOnOk)="createMeeting()" nzOkText="Lưu thông tin">
  <ng-container *nzModalContent>
    <nz-tabs nzCentered>
      <nz-tab [nzTitle]="ttch">
        <ng-template #ttch>
          <i class="bi bi-info-circle"> </i>
          Thông tin cuộc họp
        </ng-template>
        <div class="tab-create">
          <div nz-row>
            <div nz-col class="gutter-row" [nzSpan]="24">
              <div class="inner-box">
                <label> Tên cuộc họp </label>
                <input nz-input [(ngModel)]="meeting.name" class="space-control" />
                <label> Nội dung / Mục tiêu </label>
                <input nz-input [(ngModel)]="meeting.meetContent" class="space-control" />
                <label> Phòng họp </label>
                <nz-select [(ngModel)]="meeting.roomId" class="space-control" nzPlaceHolder="Chọn phòng họp"
                  nzShowSearch (ngModelChange)="onRoomChange($event)">
                  <nz-option *ngFor="let room of listRoom" [nzValue]="room.code" [nzLabel]="room.name">
                  </nz-option>
                </nz-select>
                <label> Thời gian bắt đầu dự kiến </label>
                <nz-date-picker [(ngModel)]="meeting.expectedStartTime" class="space-control" nzShowTime
                  [nzFormat]="'dd/MM/yyyy HH:mm:ss'">
                </nz-date-picker>
                <label> Ghi chú </label>
                <textarea rows="4" nz-input [(ngModel)]="meeting.notes" class="space-control">
                </textarea>
                <div class="project-file">
                  <div class="file-upload-area" (click)="fileInput.click()">
                    <div>
                      <img src="img/folder_upload.png" class="img-upload" />
                    </div>
                    <h3>Tải lên file đính kèm</h3>
                    <p style="color: #666; font-size: 14px">
                      Hỗ trợ các định dạng: PDF, DOC, DOCX, XLS, XLSX, PNG, JPG
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div nz-col class="gutter-row" [nzSpan]="24">
              <div class="inner-box">
                <nz-empty *ngIf="meeting.files.length === 0"
                  [nzNotFoundContent]="'Không có văn bản tài liệu nào được tải lên!'"
                  [nzNotFoundFooter]="'Vui lòng chọn file để đính kèm trong cuộc họp!'"
                  style="padding-top: 16%; color: gray">
                </nz-empty>
                <div class="file-list" *ngIf="meeting.files.length > 0">
                  @for(i of meeting.files; track i){
                  <div class="file-item">
                    <div class="file-icon">
                      <img [src]="i.icon" />
                    </div>
                    <div class="file-info">
                      <div class="file-name">{{i.fileName}}</div>
                      <div class="file-meta">
                        <span>
                          {{ i.fileSize < 1048576 ? (i.fileSize / 1024 | number : "1.1-1" ) + " KB" : (i.fileSize /
                            1048576 | number : "1.1-1" ) + " MB" }} </span>
                            <span>
                              {{i.createDate | date: 'dd/MM/yyyy HH:mm'}}
                            </span>
                      </div>
                    </div>
                    <div class="file-actions">
                      <i class="bi bi-cloud-download" nz-tooltip="Tải xuống" style="color: #10b981">
                      </i>
                      <i class="bi bi-trash3" style="color: red" nz-tooltip="Xoá" (click)="deleteFile(i)">
                      </i>
                    </div>
                  </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      </nz-tab>
      <nz-tab [nzTitle]="tv">
        <ng-template #tv>
          <i class="bi bi-person-add"> </i>
          Thành viên
        </ng-template>
        <div class="tab-create">
          <div nz-row>
            <div nz-col class="gutter-row" [nzSpan]="24">
              <div class="inner-box">
                <div style="padding-bottom: 5px">
                  <nz-input-group nzSearch [nzSuffix]="inputClearTpl" [nzAddOnAfter]="suffixIcons">
                    <input type="text" nz-input placeholder="Tìm kiếm" [(ngModel)]="keyword" (keydown.enter)="search()"
                      allowClear />
                  </nz-input-group>
                  <ng-template #inputClearTpl>
                    <nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      (click)="keyword = ''; search()" />
                  </ng-template>
                  <ng-template #suffixIcons>
                    <button nz-button>
                      <nz-icon nzType="search" (click)="search()" />
                    </button>
                    <button nz-button>
                      <nz-icon nzType="redo" (click)="keyword = ''; search()" />
                    </button>
                  </ng-template>
                </div>
                <nz-table #expandTable [nzData]="listOfMapData" nzTableLayout="fixed" nzSize="small" nzBordered
                  [nzFrontPagination]="false" [nzScroll]="{ y: '1000px' }">
                  >
                  <thead>
                    <tr>
                      <!-- <th nzWidth="32px" nzAlign="center"></th> -->
                      <th nzWidth="300px" nzAlign="center">
                        Đơn vị | Thành viên
                      </th>
                      <!-- <th nzAlign="center">Chức vụ | Địa chỉ</th> -->
                      <th nzAlign="center" nzWidth="80px">Thành viên</th>
                      <th nzAlign="center" nzWidth="66px">Chủ trì</th>
                      <th nzAlign="center" nzWidth="66px">Thư ký</th>
                      <th nzAlign="center" nzWidth="100px">
                        Tham gia
                        <br />
                        biểu quyết
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (data of expandTable.data; track data) { @for (item of
                    mapOfExpandedData[data.key]; track item) { @if ((item.parent
                    && item.parent.expand) || !item.parent) {
                    <tr>
                      <!-- <td nzAlign="center">
                        <nz-icon
                          *ngIf="item.typeBuildTree === 'USER' || item.typeBuildTree === 'ORG'"
                          [nzType]="item.typeBuildTree === 'USER' ? 'user' : 'home'"
                          [style.color]="item.typeBuildTree === 'USER' ? '#378a00' : '#1890ff'"
                        />
                      </td> -->
                      <td [nzIndentSize]="item.level! * 20" [nzShowExpand]="!!item.children" [(nzExpand)]="item.expand"
                        (nzExpandChange)="collapse(mapOfExpandedData[data.key], item, $event)">
                        <div>
                          <span *ngIf="item.typeBuildTree == 'ORG'" style="font-weight: 600">
                            {{ item.fullName }}
                          </span>
                          <span style="font-weight: 600" *ngIf="item.typeBuildTree == 'USER'">
                            {{ item.fullName }}
                          </span>
                        </div>
                        <div *ngIf="item.typeBuildTree == 'USER'">
                          <div>
                            <span style="font-weight: 600">- Chức vụ: </span>
                            {{item.title?.name}}
                          </div>
                          <div>
                            <span style="font-weight: 600">- Địa chỉ: </span>
                            {{item.address}}
                          </div>
                        </div>
                      </td>
                      <!-- <td>
                        <div *ngIf="item.typeBuildTree == 'USER'">
                          <div>
                            <span style="font-weight: 600"> Chức vụ: </span>
                            {{item.title?.name}}
                          </div>
                          <div>
                            <span style="font-weight: 600"> Địa chỉ: </span>
                            {{item.address}}
                          </div>
                        </div>
                      </td> -->
                      <td nzAlign="center">
                        <label nz-checkbox [(ngModel)]="item.isThanhVien"
                          (ngModelChange)="onChangeCheckbox(item, 'isThanhVien')">
                        </label>
                      </td>
                      <td nzAlign="center">
                        <label *ngIf="item.typeBuildTree === 'USER'" nz-checkbox [(ngModel)]="item.isChuTri"
                          (ngModelChange)="onChangeCheckbox(item, 'isChuTri')">
                        </label>
                      </td>
                      <td nzAlign="center">
                        <label *ngIf="item.typeBuildTree === 'USER'" nz-checkbox [(ngModel)]="item.isThuKy"
                          (ngModelChange)="onChangeCheckbox(item,'isThuKy')">
                        </label>
                      </td>
                      <td nzAlign="center">
                        <label nz-checkbox [(ngModel)]="item.isParticipateInVoting" [nzDisabled]="!item.isThanhVien"
                          (ngModelChange)="onChangeCheckbox(item, 'isParticipateInVoting')">
                        </label>
                      </td>
                    </tr>
                    } } }
                  </tbody>
                </nz-table>
              </div>
            </div>
            <div nz-col class="gutter-row" [nzSpan]="24">
              <div class="inner-box">
                <nz-table #basicTable [nzData]="meeting.personal" nzSize="small" [nzFrontPagination]="false" nzBordered
                  [nzScroll]="{ y: 'calc(100dvh - 220px)' }">
                  <thead>
                    <tr>
                      <th nzWidth="60px" nzAlign="center">STT</th>
                      <th>Họ và tên</th>
                      <th nzAlign="center">Vai trò</th>
                      <th nzAlign="center">Bỏ chọn</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of basicTable.data; let i = index">
                      <td nzAlign="center">{{ i + 1}}</td>
                      <td>
                        {{data.fullName}}
                        <br />
                        <span style="color: gray; font-size: small">
                          ({{data.title?.name}})
                        </span>
                      </td>
                      <td nzAlign="center">
                        <nz-tag [nzColor]="data.isChuTri ? 'success' : data.isThuKy ? 'processing' : 'default'">
                          {{ data.isChuTri ? 'Chủ trì' : data.isThuKy ? 'Thư ký'
                          : 'Thành viên' }}
                        </nz-tag>
                      </td>
                      <td nzAlign="center">
                        <button nz-button nzType="dashed" nzSize="small" (click)="deletePersonal(data)">
                          <nz-icon nzType="minus" nzTheme="outline" />
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
          </div>
        </div>
      </nz-tab>

      <nz-tab [nzTitle]="bq">
        <ng-template #bq>
          <i class="bi bi-clipboard-check"> </i>
          Biểu quyết
        </ng-template>
        <div class="tab-create">
          <div class="bieu-quyet-container">
            <div style="
                display: flex;
                justify-content: flex-end;
                padding: 0 6px;
                padding-bottom: 12px;
              ">
              <button nz-button nzType="dashed" (click)="addVote()">
                <nz-icon nzType="plus" nzTheme="outline" />Thêm biểu quyết
              </button>
            </div>

            <nz-empty *ngIf="listMeetingVote.length == 0"
              [nzNotFoundContent]="'Không có biểu quyết nào trong cuộc họp!'"
              [nzNotFoundFooter]="'Vui lòng thêm mới biểu quyết!'" style="padding-top: 100px; color: gray"></nz-empty>
            <nz-table #meetingVoteTable [nzData]="listMeetingVote" *ngIf="listMeetingVote.length != 0" nzSize="small"
              [nzFrontPagination]="false" nzBordered [nzScroll]="{ y: '1000px' }">
              <thead>
                <tr>
                  <th nzAlign="center" nzWidth="60px">STT</th>
                  <th nzAlign="center">Biểu quyết</th>
                  <th nzAlign="center">Mô tả</th>
                  <th nzAlign="center" nzWidth="120px">Thời gian (phút)</th>
                  <th nzAlign="center" nzWidth="360px">Văn bản đính kèm</th>
                  <th nzAlign="center" nzWidth="50px"></th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let data of meetingVoteTable.data; let i = index">
                  <td nzAlign="center">{{ i + 1 }}</td>
                  <td>
                    <textarea rows="2" nz-input [(ngModel)]="data.name" placeholder="Tiêu đề"></textarea>
                  </td>
                  <td>
                    <textarea rows="2" nz-input [(ngModel)]="data.notes" placeholder="Mô tả"></textarea>
                  </td>
                  <td nzAlign="center">
                    <input nz-input type="number" min="1" max="120" [(ngModel)]="data.time" />
                  </td>

                  <td>
                    <div class="file-list-vote">
                      <ng-container *ngFor="let e of data.files">
                        <div class="file-item">
                          <div class="file-icon"><img [src]="e.icon" /></div>
                          <div class="file-info">
                            <div class="file-name">{{ e.fileName }}</div>

                            <div class="file-meta">
                              <span>{{ e.fileSize < 1048576 ? (e.fileSize / 1024 | number : '1.1-1' ) + ' KB' :
                                  (e.fileSize / 1048576 | number : '1.1-1' ) + ' MB' }}</span>
                                  <span>{{ e.createDate | date: 'dd/MM/yyyy HH:mm'
                                    }}</span>
                            </div>
                          </div>
                          <div class="file-actions">
                            <i class="bi bi-x-circle" nz-tooltip="Xóa" (click)="deleteFileMeetingVoteCreate(i, e)"></i>
                          </div>
                        </div>
                      </ng-container>

                      <div class="file-upload-area-vote" (click)="onClickUploadFile(i)">
                        <i class="bi bi-upload" style="margin-right: 6px"></i>
                        <span>Tải lên văn bản biểu quyết</span>
                      </div>
                    </div>
                  </td>

                  <td nzAlign="center">
                    <button nz-button nzDanger (click)="deleteVote(i)">
                      <nz-icon nzType="delete"></nz-icon>
                    </button>
                  </td>
                </tr>
              </tbody>
            </nz-table>
          </div>
        </div>
      </nz-tab>

      <nz-tab [nzTitle]="sdph">
        <ng-template #sdph>
          <i class="bi bi-grid"> </i>
          Sơ đồ phòng họp
        </ng-template>
        <div class="tab-create">
          <div *ngIf="!meeting.roomId" class="text-center text-gray-500 mt-4">
            <i class="bi bi-exclamation-circle text-5xl mb-3 text-gray-400">
            </i>
            <p class="text-lg">Vui lòng chọn phòng họp để xem sơ đồ</p>
          </div>
          <div *ngIf="meeting.roomId && (!meeting.personal.length || meeting.personal.length === 0)"
            class="text-center text-gray-500 mt-4">
            <i class="bi bi-people text-5xl mb-3 text-gray-400"> </i>
            <p class="text-lg">Chưa chọn người tham dự nào</p>
            <p class="text-sm">
              Vui lòng chọn thành viên trong tab "Thành viên"
            </p>
          </div>
          <div *ngIf="meeting.roomId && meeting.personal.length && meeting.personal.length > 0"
            class="room-diagram-container">
            <div class="participants-sidebar">
              <h3 class="sidebar-title">Danh sách người tham dự</h3>
              <ul class="participants-list">
                <li *ngFor="let person of availablePersons" class="participant-item" draggable="true"
                  (dragstart)="onDragStart($event, person)" (dragend)="onDragEnd($event)">
                  <div class="participant-info">
                    <div class="participant-name">
                      {{ person.fullName || person.userName }}
                    </div>
                    <div class="participant-title">
                      {{ person.title?.name || '—' }}
                    </div>
                  </div>
                  <button nz-button nzType="dashed" nzSize="small" (click)="deletePersonal(person)">
                    <nz-icon nzType="minus" nzTheme="outline" />
                  </button>
                </li>
              </ul>
            </div>
            <div class="canvas-section">
              <h3 class="canvas-title">
                Sơ đồ phòng họp: {{ selectedRoom?.name || meeting.roomId }}
              </h3>
              <div class="canvas-container-wrapper" (dragover)="onCanvasDragOver($event)" (drop)="onCanvasDrop($event)"
                (dragleave)="onCanvasDragLeave($event)">
                <div class="room-canvas" [style.width.px]="roomCanvasWidth" [style.height.px]="roomCanvasHeight">
                  <div *ngFor="let item of roomItems; trackBy: trackByItemId"
                    class="room-item item-{{item.type}} style-{{item.style}}"
                    [class.chair-occupied]="item.type === 'chair' && item.assignedPerson"
                    [class.chair-available]="item.type === 'chair' && !item.assignedPerson" [style.left.px]="item.x"
                    [style.top.px]="item.y" [style.width.px]="item.width" [style.height.px]="item.height"
                    [style.transform]="'rotate(' + item.rotation + 'deg)'" [attr.data-item-id]="item.id"
                    (dragover)="onItemDragOver($event, item)" (drop)="onItemDrop($event, item)"
                    (dragleave)="onChairDragLeave($event, item)">
                    <div class="item-content">
                      <span *ngIf="item.type === 'table'" nz-icon nzType="table" nzTheme="outline">
                      </span>
                      <div *ngIf="item.type === 'chair'" class="chair-content">
                        <!-- ✅ Thêm draggable cho ghế đã có người -->
                        <div *ngIf="item.assignedPerson; else emptyChair" class="assigned-person" nz-tooltip
                          draggable="true" (dragstart)="onChairPersonDragStart($event, item)"
                          (dragend)="onDragEnd($event)"
                          [nzTooltipTitle]="item.assignedPerson.fullName + ' - ' + (item.assignedPerson.title?.name || '')">
                          <nz-avatar [nzText]="global.getInitialsAvatar(item.assignedPerson.fullName)" [nzSize]="28"
                            [ngStyle]="{
                                                    'background-color': global.getAvatarColor(item.assignedPerson.fullName),
                                                    'color': 'white',
                                                    'font-weight': 600
                                                    }">
                          </nz-avatar>
                          <button class="remove-person-btn" (click)="removePersonFromChair($event, item)" nz-tooltip
                            nzTooltipTitle="Gỡ người">
                            <i class="bi bi-x"> </i>
                          </button>
                        </div>
                        <ng-template #emptyChair>
                          <span nz-icon nzType="user" nzTheme="outline"> </span>
                        </ng-template>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nz-tab>
    </nz-tabs>
  </ng-container>
</nz-modal>

<input type="file" #fileInput hidden multiple (change)="upload($event)" />

<!-- #region Drawer tạo mới biểu quyết  -->

<input type="file" #fileInputAddBieuQuyet hidden multiple (change)="uploadFileMeetingVote($event)" />

<!-- #endregion -->
<!-- #region modal Profile-->
<nz-modal [(nzVisible)]="isVisibleProfile" [nzTitle]="undefined" nzWidth="100%" [nzFooter]="null"
  [nzStyle]="{ top: '10px' }" (nzOnCancel)="isVisibleProfile=!isVisibleProfile">
  <ng-container *nzModalContent>
    <nz-tabs nzCentered>
      <nz-tab [nzTitle]="tt">
        <ng-template #tt>
          <nz-icon nzType="info-circle" nzTheme="outline" />
          Thông tin
        </ng-template>
        <div style="padding: 10px 20px">
          <label>Tài khoản</label>
          <input nz-input [(ngModel)]="dto.userName" [disabled]="true" class="space-control" />

          <label>Tên đầy đủ</label>
          <input nz-input [(ngModel)]="dto.fullName" class="space-control" />

          <label>Đơn vị</label>
          <input nz-input [(ngModel)]="dto.orgId" [disabled]="true" class="space-control" />

          <label>Chức danh</label>
          <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.titleCode" class="space-control">
            <nz-option *ngFor="let i of lstTitle" [nzLabel]="i.name" [nzValue]="i.code"></nz-option>
          </nz-select>

          <label>Số điện thoại</label>
          <input nz-input [(ngModel)]="dto.phone" class="space-control" />

          <label>Email</label>
          <input nz-input [(ngModel)]="dto.email" class="space-control" />

          <label>Địa chỉ</label>
          <input nz-input [(ngModel)]="dto.address" class="space-control" />

          <nz-radio-group [(ngModel)]="dto.isActive">
            <label nz-radio [nzValue]="true">Kích hoạt</label>
            <label nz-radio [nzValue]="false">Khoá</label>
          </nz-radio-group>
        </div>
        <nz-space style="
            padding: 10px 20px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: end;
          ">
          <button (click)="updateProfile()" *nzSpaceItem nz-button nzType="primary" class="btn-green">
            <nz-icon nzType="save" nzTheme="outline" /> Cập nhật
          </button>
          <button *nzSpaceItem nz-button nzType="primary" nzDanger (click)="logOut()">
            <nz-icon nzType="logout" nzTheme="outline" /> Đăng xuất
          </button>
        </nz-space>
      </nz-tab>
      <nz-tab [nzTitle]="faceId">
        <ng-template #faceId>
          <nz-icon nzType="scan" nzTheme="outline" />
          Face ID
        </ng-template>
        <div style="padding: 10px 20px">
          <app-setting-register-face-id
            (onCancelRegisterFace)="isShowModalRegisterFaceId = false"></app-setting-register-face-id>
        </div>
      </nz-tab>
    </nz-tabs>
  </ng-container>
</nz-modal>

<!-- #endregion-->

<!-- #region drawer calendar-->
<nz-drawer [nzClosable]="false" [nzVisible]="isVisibleCalendar" nzPlacement="right" nzTitle="Lịch"
  (nzOnClose)="isVisibleCalendar =!isVisibleCalendar" [nzExtra]="extra">
  <ng-template #extra>
    <a nz-button nzType="text" (click)="isVisibleCalendar =!isVisibleCalendar">
      <i class="bi bi-x-lg" style="font-size: 18px"></i>
    </a>
  </ng-template>
  <ng-container *nzDrawerContent>
    <div class="card-calender">
      <nz-calendar [(ngModel)]="date" [(nzMode)]="mode" (nzPanelChange)="panelChange($event)"
        (nzSelectChange)="onDateSelect($event)" [nzDateCell]="dateCellTpl">
      </nz-calendar>
      <ng-template #dateCellTpl let-date>
        <div class="calendar-cell">
          <div *ngIf="hasEvent(date)" class="event-indicator"></div>
        </div>
      </ng-template>
    </div>
  </ng-container>
</nz-drawer>
<!-- end region-->

<nz-modal [(nzVisible)]="isVisibleQRScanner" [nzClosable]="false" nzCentered [nzTitle]="undefined" [nzFooter]="null" (nzOnCancel)="closeQRScanner()" [nzStyle]="{ top: '10px' }"
  nzWidth="90%">
  <ng-container *nzModalContent>
    <div id="qr-reader" style="width: 100%;"></div>
  </ng-container>
</nz-modal>